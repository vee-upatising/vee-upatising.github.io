const videoElement = document.getElementById('video');
const canvas = document.getElementById('canvas');
const canvas2 = document.getElementById('canvas2');
const randomBtn = document.getElementById('random');
const ctx = canvas.getContext('2d');
var slider = document.getElementById("myRange");

//placeholder variable for user uploaded image
var imageData;
var output;
var model;

load_model()
//generate face from random input on button press
randomBtn.addEventListener('click', e => {inference(Array.from({length: 64}, () => Math.random()))});
//generates face based on input
function inference(input){
    input = tf.tensor(input,[1,64])
    output = model.predict(input)
    output = tf.squeeze(output,)
    output = output.mul(255)
    data = output.dataSync()
    //create a buffer array
    const buffer = new Uint8ClampedArray(64 * 64 * 4)
    //create an Image data var 
    im = new ImageData(64, 64);

    //map the values to the buffer
    var i = 0;
    for(var y = 0; y < 64; y++) {
      for(var x = 0; x < 64; x++) {
        var pos = (y * 64 + x) * 4;      // position in buffer based on x and y
        buffer[pos  ] = data[i]             // some R value [0, 255]
        buffer[pos+1] = data[i+1]           // some G value
        buffer[pos+2] = data[i+2]           // some B value
        buffer[pos+3] = 255;                // set alpha channel
        i+=3
      }
    }

    //set the buffer to the image data
    im.data.set(buffer)
    createImageBitmap(im).then(renderer => ctx.drawImage(renderer, 0,0, 256, 256))
}

//update model variable
function setvariable(net){
  model = net;
}

async function load_model(){
  const net = await tf.loadLayersModel('https://raw.githubusercontent.com/vee-upatising/Anime-DCGAN/7039aadd7fb73de418ed33b40b78221366686e21/model.json').then(net => setvariable(net))
}

slider.oninput = function() {
    if(this.value == 1){
        inference([-0.4898187602449412,-0.691193486296515,2.20883210115179,-2.1503718801754115,0.8407567324258899,2.000604072790486,-0.33607449807148465,-1.0251337256851805,-0.5141143195439936,-1.0833192388257518,-1.2158047053733199,-0.1116068585692603,0.29440383164715966,-0.35888818649626236,0.34688613591578144,0.22327949712491174,-0.5295790051335344,-0.4036227413592917,-0.2597357331968515,0.2401039397707995,-1.5232068921467017,0.055078991788332976,0.41461054616920273,-0.04058248493891466,1.055765950376698,0.570673415738075,-0.7492349783136398,-1.8686829843462134,-0.5047054134167316,0.16300283102315402,0.1807394079949449,-0.1227498632612443,-0.3920877739116517,1.2098873973400368,-0.9437428799981532,-2.2221665673082573,0.8040695421350816,-0.333553857704881,1.3645498825738929,-0.8963973429403682,-0.2532031869816623,-0.9396753188030175,0.9947773147950814,-0.035460539100680234,-2.157910806522453,0.6693654757703034,0.08119816284444631,1.2670033822735522,0.541245649661114,-0.975496561945487,0.4130061856553619,-2.1829749474373443,0.2036736823889734,0.5531559804633118,0.07308150989026507,-2.3830588436057587,-1.3342437397985798,2.3223527960522095,-1.824396651864799,-0.9199164184685139,0.8690055524175085,0.10132873463298823,0.6397116924285328,0.7378245673877792])
    }
    if(this.value == 2){
        inference([-0.4771072463295004,-0.49239191201431376,2.148161110494734,-1.6161876123015588,0.9479711672306927,1.4181447587728038,0.6700723740393044,-0.7371711580393836,-0.3519201466057456,-0.8586297619410392,-0.2978380317647247,0.298537020523843,0.27031733620017107,-0.18102498244538567,0.040176225852156855,0.457193649231022,-0.28254209636817407,0.07107838463092336,-0.3924886726206601,0.1205899484833014,-0.9111221761461588,0.6054426296074547,0.2085054374193498,0.07160808487442691,1.004340851162602,0.6676387812565298,-0.13347195608930273,-1.3859177810621883,-0.4856464837475879,-0.31392853802085097,0.18212733405975556,-0.6932666035538108,0.4405035028341856,1.3464955440037882,-0.6374269447519048,-1.424841815747731,0.5773365656216005,-0.2749759907893614,0.831979782958757,-0.6423690599207101,-0.13935868328872336,-0.6698242410348885,0.3402880189530231,-0.6752011076514987,-1.0788341257876186,0.4195399280257387,0.11736336367463451,1.0856927478276654,0.3468980110891451,-0.8816975034091927,-0.10655761974404448,-1.7168087685273954,0.8256507324193733,0.5708592494383462,0.21956478730554177,-1.2344557639839975,-0.7899226838739747,1.747349715125012,-0.9287382235163252,-0.6132019876210277,0.5560898752658749,0.19249546797029365,1.378179310573448,0.5724605138478676])
    }
    if(this.value == 3){
        inference([-0.4643957324140596,-0.29359033773211246,2.087490119837677,-1.082003344427706,1.0551856020354957,0.8356854447551214,1.6762192461500935,-0.44920859039358674,-0.18972597366749766,-0.6339402850563267,0.6201286418438705,0.7086808996169462,0.2462308407531824,-0.003161778394508985,-0.2665336842114677,0.6911078013371323,-0.03550518760281368,0.5457795106211385,-0.5252416120444687,0.0010759571958033065,-0.29903746014561583,1.1558062674265763,0.002400328669496854,0.18379865468776846,0.9529157519485056,0.7646041467749845,0.48229106613503436,-0.903152577778163,-0.4665875540784442,-0.790859907064856,0.18351526012456626,-1.2637833438463772,1.273094779580023,1.4831036906675394,-0.3311110095056563,-0.6275170641872045,0.3506035891081195,-0.21639812387384177,0.29940968334362106,-0.38834077690105206,-0.025514179595784447,-0.39997316326675936,-0.3142012768890352,-1.314941676202317,0.00024255494721581172,0.16971438028117403,0.15352856450482272,0.9043821133817789,0.15255037251717612,-0.7878984448728985,-0.6261214251434508,-1.2506425896174467,1.447627782449773,0.5885625184133806,0.36604806472081847,-0.08585268436223625,-0.24560162794936957,1.1723466341978146,-0.03307979516785142,-0.30648755677354145,0.24317419811424124,0.28366220130759906,2.116646928718363,0.407096460307956])
    }
    if(this.value == 4){
        inference([-0.45168421849861884,-0.09478876344991116,2.0268191291806206,-0.5478190765538531,1.1624000368402987,0.25322613073743905,2.682366118260883,-0.16124602274778987,-0.02753180072924971,-0.4092508081716143,1.5380953154524655,1.1188247787100496,0.2221443453061938,0.17470142565636765,-0.5732435942750923,0.9250219534432425,0.2115317211625467,1.0204806366113535,-0.6579945514682773,-0.11843803409169482,0.3130472558549271,1.706169905245698,-0.20370478008035614,0.29598922450111004,0.9014906527344095,0.8615695122934393,1.0980540883593715,-0.420387374494138,-0.4475286244093005,-1.267791276108861,0.18490318618937696,-1.8343000841389439,2.1056860563258604,1.6197118373312909,-0.024795074259407857,0.16980768737332186,0.1238706125946385,-0.15782025695832216,-0.23316041627151485,-0.134312493881394,0.08833032409715447,-0.13012208549863036,-0.9686905727310935,-1.9546822447531353,1.0793192356820502,-0.08011116746339064,0.18969376533501095,0.7230714789358921,-0.041797266054792837,-0.6940993863366043,-1.145685230542857,-0.784476410707498,2.069604832480173,0.606265787388415,0.5125313421360952,1.062750395259525,0.29871942797523565,0.5973435532706173,0.8625786331806224,0.00022687407394472725,-0.06974147903739236,0.3748289346449045,2.855114546863278,0.24173240676804436])
    }
    if(this.value == 5){
        inference([-0.43897270458317805,0.10401281083229008,1.966148138523564,-0.013634808680000443,1.2696144716451014,-0.3292331832802433,3.688512990371672,0.126716544898007,0.13466237220899824,-0.18456133128690178,2.4560619890610607,1.528968657803153,0.1980578498592052,0.3525646297072444,-0.8799535043387169,1.1589361055493528,0.45856862992790703,1.4951817626015687,-0.790747490892086,-0.23795202537919288,0.92513197185547,2.25653354306482,-0.409809888830209,0.4081797943144516,0.8500655535203133,0.9585348778118941,1.7138171105837086,0.06237782878988729,-0.42846969474015684,-1.7447226451528661,0.18629111225418762,-2.4048168244315105,2.9382773330716976,1.7563199839950423,0.2815208609868406,0.9671324389338483,-0.10286236391884263,-0.09924239004280255,-0.7657305158866508,0.11971578913826408,0.20217482779009338,0.13972899226949875,-1.6231798685731518,-2.5944228133039537,2.1583959164168847,-0.3299367152079553,0.22585896616519915,0.5417608444900054,-0.23614490462676174,-0.6003003278003101,-1.6652490359422636,-0.318310231797549,2.691581882510573,0.6239690563634493,0.6590146195513719,2.211353474881286,0.8430404838998407,0.022340472343419737,1.758237061529096,0.306941304921431,-0.38265715618902607,0.4659956679822099,3.5935821650081934,0.07636835322813273])
    }
    if(this.value == 6){
        inference([-0.43897270458317805,0.1040128108322901,1.966148138523564,-0.013634808680000299,1.2696144716451014,-0.3292331832802435,3.688512990371672,0.126716544898007,0.13466237220899824,-0.1845613312869018,2.456061989061061,1.528968657803153,0.1980578498592052,0.35256462970724434,-0.8799535043387169,1.1589361055493528,0.45856862992790703,1.4951817626015687,-0.790747490892086,-0.23795202537919288,0.9251319718554701,2.2565335430648195,-0.40980988883020897,0.4081797943144516,0.8500655535203133,0.9585348778118941,1.7138171105837086,0.06237782878988721,-0.42846969474015684,-1.7447226451528661,0.18629111225418762,-2.4048168244315105,2.9382773330716976,1.7563199839950423,0.28152086098684065,0.9671324389338483,-0.10286236391884263,-0.09924239004280255,-0.7657305158866506,0.11971578913826406,0.2021748277900934,0.13972899226949867,-1.6231798685731518,-2.5944228133039537,2.158395916416885,-0.3299367152079553,0.22585896616519915,0.5417608444900054,-0.23614490462676174,-0.6003003278003101,-1.6652490359422638,-0.318310231797549,2.691581882510573,0.6239690563634493,0.6590146195513719,2.2113534748812858,0.8430404838998408,0.022340472343419838,1.758237061529096,0.30694130492143096,-0.382657156189026,0.4659956679822099,3.5935821650081934,0.07636835322813272])
    }
    if(this.value == 7){
        inference([-0.458533541802169,-0.25878668743457567,1.622778456039702,-0.046539647154196395,0.854613977600053,-0.24407277388433066,2.474713649834959,0.04700338610680009,0.04813688438793645,-0.7075090631216339,1.9590884396828638,1.0703361599274914,0.2944117760668796,0.305589970387849,-0.8492987975292654,0.8086048156730391,0.33256544561557555,1.2862679965888637,-0.6981319718732201,-0.05714160446234143,0.4708948162111791,1.8042782029796385,-0.2520042518165822,0.6758985095239751,0.6672553025881156,0.5661764354201038,1.1081015312894258,0.14241484126553144,-0.22928027482398042,-1.215115341905621,0.16030248729420662,-1.8784182243603413,2.3171463074507144,1.2999507431322652,0.33219451023339197,0.7052493535278641,-0.07341896517792121,-0.09621543710846228,0.17920503781436803,0.33531339906294877,0.1776569341849612,0.8785661660326805,-1.0291419814119833,-2.0049238935625224,1.43978097272009,-0.07631510179658152,-0.08702955603309923,1.385932373841129,-0.8939484756093182,-0.2940776507049503,-1.1997014220929858,-0.11284403662955925,1.1882955752091502,0.36799213889289684,0.10147644304705739,1.7461393541135946,-0.09834415974527222,0.015011188443065123,1.53648787861145,0.1922844926428137,-0.25810626049030266,0.06124577024982297,2.409520579172775,0.2914679257180178])
    }
    if(this.value == 8){
        inference([-0.4780943790211599,-0.6215861857014414,1.2794087735558402,-0.0794444856283925,0.4396134835550044,-0.15891236448841783,1.2609143092982462,-0.03270977268440681,-0.038388603433125335,-1.230456794956366,1.4621148903046666,0.61170366205183,0.3907657022745541,0.2586153110684537,-0.8186440907198138,0.4582735257967254,0.20656226130324407,1.0773542305761588,-0.6055164528543542,0.12366881645451003,0.01665766056688811,1.3520228628944575,-0.09419861480295544,0.9436172247334987,0.4844450516559178,0.17381799302831347,0.5023859519951432,0.22245185374117568,-0.030090854907804,-0.6855080386583758,0.13431386233422563,-1.3520196242891722,1.6960152818297314,0.843581502269488,0.38286815947994335,0.44336626812187985,-0.04397556643699978,-0.09318848417412201,1.1241405915153866,0.5509110089876335,0.15313904057982897,1.6174033397958623,-0.43510409425081464,-1.4154249738210916,0.7211660290232951,0.17730651161479227,-0.3999180782313976,2.2301039031922527,-1.5517520465918748,0.012145026390409486,-0.7341538082437078,0.09262215853843053,-0.31499073209227246,0.11201522142234432,-0.4560617334572571,1.2809252333459034,-1.039728803390385,0.007681904542710408,1.3147386956938039,0.07762768036419643,-0.13355536479157934,-0.343504127482564,1.225458993337357,0.5065674982079028])
    }
    if(this.value == 9){
        inference([-0.49765521624015086,-0.9843856839683071,0.9360390910719782,-0.1123493241025886,0.02461298950995583,-0.07375195509250504,0.047114968761533316,-0.11242293147561372,-0.12491409125418712,-1.753404526791098,0.9651413409264695,0.15307116417616862,0.48711962848222856,0.21164065174905833,-0.7879893839103622,0.10794223592041186,0.08055907699091258,0.8684404645634537,-0.5129009338354884,0.3044792373713614,-0.4375794950774029,0.8997675228092767,0.06360702221067133,1.2113359399430224,0.30163480072372006,-0.21854044936347683,-0.1033296272991393,0.3024888662168199,0.1690985650083724,-0.1559007354111306,0.10832523737424463,-0.8256210242180031,1.0748842562087484,0.38721226140671083,0.43354180872649467,0.18148318271589559,-0.014532167696078346,-0.09016153123978175,2.0690761452164055,0.7665086189123183,0.12862114697469676,2.3562405135590443,0.1589337929103538,-0.8259260540796605,0.0025510853265000577,0.43092812502616606,-0.7128066004296959,3.0742754325433763,-2.209555617574431,0.31836770348576926,-0.2686061943944298,0.2980883537064203,-1.8182770393936951,-0.1439616960482082,-1.0135999099615716,0.8157111125782122,-1.981113447035498,0.0003526206423556909,1.0929895127761577,-0.037029131914420865,-0.009004469092856016,-0.748254025214951,0.041397407501938766,0.7216670706977879])
    }
    if(this.value == 10){
        inference([-0.5172160534591418,-1.3471851822351728,0.5926694085881163,-0.1452541625767847,-0.39038750453509263,0.011408454303407811,-1.1666843717751796,-0.1921360902668206,-0.2114395790752489,-2.2763522586258302,0.46816779154827226,-0.3055613336994929,0.583473554689903,0.164665992429663,-0.7573346771009107,-0.24238905395590193,-0.0454441073214189,0.6595266985507487,-0.4202854148166225,0.4852896582882129,-0.8918166507216939,0.44751218272409576,0.2214126592242981,1.4790546551525459,0.11882454979152224,-0.6108988917552671,-0.7090452065934221,0.3825258786924641,0.36828798492454884,0.37370656783611444,0.08233661241426363,-0.299222424146834,0.4537532305877652,-0.06915697945606625,0.484215457973046,-0.08039990269008856,0.01491123104484307,-0.08713457830544148,3.014011698917424,0.9821062288370029,0.10410325336956455,3.095077687322226,0.7529716800715225,-0.23642713433822937,-0.716063858370295,0.6845497384375399,-1.0256951226279944,3.9184469618945,-2.867359188556988,0.624590380581129,0.19694141945484822,0.5035545488744101,-3.3215633466951178,-0.3999386135187607,-1.571138086465886,0.35049699181052096,-2.922498090680611,-0.0069766632579990225,0.8712403298585117,-0.1516859441930381,0.11554642660586734,-1.153003922947338,-1.1426641783334794,0.9367666431876729])
    }


}


